---
title: "ノウハウ備忘録"
date: 2021-11-27T21:57:28+09:00
tags: [DataVisualization]
draft: false
---
過去に見かけた、またはやらかしたしくじりなど、
後から振り返った時にこうした方が良かったと思えた事柄をまとめていく。継続的に更新したい。

# Tableau Desktop
## メジャーネームの別名設定は要注意
データソースをTableauServerへパブリッシュする前は禁止。
ワークシートで別名の設定が出来なくなり、表形式の列名やグラフの凡例で致命的です。

原因はデータソースをパブリッシュすると、別名定義の場所がワークブックからデータソースへ移動する事にあります。定義が移動するとワークブック側で編集できなくなり、特にメジャーネームの別名はロックされると表計算を使用した表で列名に余計な文字が付与される事を回避できなくなります。

## データソース置換は要注意
把握する範囲で以下の設定が消失します。再設定を忘れずに。

* 別名
* 色凡例

接続先が TableauServer のデータソースである場合は、メニューバーの `[データ] - [(データソース名)] - [Tableau データサーバー] - [サーバーおよびサイトパスの編集]` も使えます。これを使うと設定欠落が起きません。

## 表形式の空白箇所へのハイフン表示
メジャーで書式設定している場合にメジャーバリュー側の書式設定が機能しなくなります。

原因はメジャーバリューを使う表で個々のメジャーの書式設定がメジャーバリューの書式設定を上書きする事にあります。対処法は以下の通り。これを行うと個々のメジャーの書式設定が拡張され、null時の任意文字列の表示設定も解放されます。

1. ハイフン表示したいメジャーをマークカードの詳細へ追加
2. 個々メジャーへハイフン表示を設定

## 千単位の表示
Excelの書式設定のフォーマット文字列と部分的に互換性があります。
千単位表示ならば次のような指定ができます。カンマ付き。

```
#,##0,
```

小数点を表示する際は`.0`を付けます。

```
#,##0.0,
```

## パブリッシュ前の選択セル解除
ワークブックをパブリッシュする際、TableauServer上で見せるシート、ダッシュボード単位に次の操作を推奨します。

1. シートのいずれかのセルを一回選択
2. ESCキーで選択解除する

選択セルがある状態でフィルタの選択を切換えてパブリッシュした場合、ブラウザ上でフィルタを元に戻し表示した際には選択セルが解除されていたが、tabcmd で PDF 出力をフィルタ指定し行った場合には選択セル情報が残ってる事がありました。

# Tableau Server

## 実行ユーザの指定
データソースの参照先にファイルがある場合、開発や運用で使っているユーザで動かしたほうがアクセス権限関係は楽です。既定ではNetwork Serviceで動きます。

## プロキシの設定
レポートに地図を使用するものがある場合、TableauServerもインターネットと通信可能である必要があります (ユーザのブラウザだけではないという事)。不通状態では地図表示が極端に遅くなる現象が生じます。

プロキシはTableauServerを動かしているアカウント(既定: NetworkService)に対して行う必要がありますが、作業アカウントで設定するとNetowrkServiceへ設定できません。この場合、設定がマシン単位で適用されるようグループポリシーの `/コンピュータの構成/管理用テンプレート/Windowsコンポーネント/InternetExplorer` から `コンピュータ別にプロキシを設定する (ユーザ別ではなく)` を `有効` にすると全体へ適用できます。
