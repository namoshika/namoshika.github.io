<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="DBFS ストレージにはローカルとDBFSがある。 DBFSを挟むことで S3 を始めとするオブジェクトストレージへの読み書きを抽象化する。 # ローカルファイ"><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><meta name=generator content="Hugo 0.120.3"><title>Databricks を使ってみる | Memo.Namo</title>
<meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/style/main.css></head><body><div class=flexbox><div><header id=site-header class=toplevel-container><h1><a href=/>Memo.Namo</a></h1><nav><ul class=horizontal-menu><li class=horizontal-menu-item><a href=/about/>About</a></li><li class=horizontal-menu-item><a href=/knowledge/>Knowledge</a></li></ul></nav></header><main id=site-main class=toplevel-container><article class="content-container content-grid"><header class=content-grid-header><div><a class=nav-category href=/knowledge/others/>Others</a><h1 class=content-grid-title>Databricks を使ってみる</h1></div><p class=content-grid-desc><span>公開日: 2023-10-23</span>
<span>更新日: 2023-10-23</span></p></header><aside class=content-grid-side><div class=nav-sticky><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#dbfs>DBFS</a></li><li><a href=#unity-volume>Unity Volume</a></li><li><a href=#delta-lake>Delta Lake</a></li><li><a href=#auto-loader>Auto Loader</a></li><li><a href=#delta-live-tables>Delta Live Tables</a></li><li><a href=#job>Job</a></li></ul></nav><nav class=nav-tag><h2>タグ</h2><ul class=tag-container><li class="tag-item tag-item-inactive"><a href=/tags/auth/>Auth</a></li><li class="tag-item tag-item-inactive"><a href=/tags/businessman/>BusinessMan</a></li><li class="tag-item tag-item-inactive"><a href=/tags/database/>Database</a></li><li class="tag-item tag-item-active"><a href=/tags/dataengineering/>DataEngineering</a></li><li class="tag-item tag-item-inactive"><a href=/tags/datavisualization/>DataVisualization</a></li><li class="tag-item tag-item-inactive"><a href=/tags/devops/>DevOps</a></li></ul></nav></div></aside><section class="md-content content-grid-main"><h1 id=dbfs>DBFS</h1><p>ストレージにはローカルとDBFSがある。
DBFSを挟むことで S3 を始めとするオブジェクトストレージへの読み書きを抽象化する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># ローカルファイルシステム</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>fs</span> <span class=n>ls</span> <span class=n>file</span><span class=p>:</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=n>dbutils</span><span class=o>.</span><span class=n>fs</span><span class=o>.</span><span class=n>ls</span><span class=p>(</span><span class=s2>&#34;file:/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># DBFS (スキーマ未指定時にはDBFSが参照される)</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>fs</span> <span class=n>ls</span> <span class=n>dbfs</span><span class=p>:</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>fs</span> <span class=n>ls</span> <span class=o>/</span>
</span></span><span class=line><span class=cl><span class=n>dbutils</span><span class=o>.</span><span class=n>fs</span><span class=o>.</span><span class=n>ls</span><span class=p>(</span><span class=s2>&#34;dbfs:/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ローカルに対してシェルスクリプト</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>sh</span> <span class=n>ls</span> <span class=o>-</span><span class=n>Al</span> <span class=o>/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># DBFS の中でファイルをコピー</span>
</span></span><span class=line><span class=cl><span class=c1># /FileStore へ保存するとブラウザからアクセス可能</span>
</span></span><span class=line><span class=cl><span class=n>dbutils</span><span class=o>.</span><span class=n>fs</span><span class=o>.</span><span class=n>cp</span><span class=p>(</span><span class=s2>&#34;/databricks-datasets/README.md&#34;</span><span class=p>,</span> <span class=s2>&#34;/FileStore/README.md&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>displayHTML</span><span class=p>(</span><span class=s2>&#34;&lt;a href=&#39;files/README.md/&#39;&gt;aaa&lt;/a&gt;&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h1 id=unity-volume>Unity Volume</h1><p>外部ストレージへアクセスする</p><h1 id=delta-lake>Delta Lake</h1><p>Databricks は Delta を推している。このフォーマットはデータ保存へは Parquet 形式を使いつつ、メタデータ管理などを追加することで ACID トランザクションやデータのバージョニングなど高度な機能を実現している。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>spark</span><span class=o>.</span><span class=n>write</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>savePath</span><span class=p>)</span>
</span></span></code></pre></div><h1 id=auto-loader>Auto Loader</h1><p>format に cloudFiles を指定する事で Auto Loader が使えるようになる。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql.types</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>readStream</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;cloudFiles&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;cloudFiles.format&#34;</span><span class=p>,</span> <span class=s2>&#34;csv&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>schema</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>StructType</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;customer_id&#39;</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;tax_id&#39;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;tax_code&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;customer_name&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;state&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;city&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;postcode&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;street&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;number&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;unit&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;region&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;district&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;lon&#39;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;lat&#39;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;ship_to_address&#39;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;valid_from&#39;</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;valid_to&#39;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;units_purchased&#39;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s1>&#39;loyalty_segment&#39;</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/databricks-datasets/retail-org/customers/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>display</span><span class=p>(</span><span class=n>df</span><span class=p>)</span>
</span></span></code></pre></div><h1 id=delta-live-tables>Delta Live Tables</h1><p>データパイプラインを簡単に構築する仕組み。</p><p>宣言的にテーブルやビューを定義する事で依存関係からパイプラインを構築できる。宣言されたテーブルはパイプライン内のみで参照可能。外部からも参照したい場合はパイプラインを構成する際にターゲットスキーマを指定する。テーブルは実際にはマテリアライズド・ビューとして扱われる。</p><p>いくつか制約がある。</p><ul><li><code>%pip</code> 以外のマジックコマンドは使用不可 &mldr; 使ったセルは実行がスキップされる</li><li>共有コンピュートクラスターからのみ参照可能 &mldr; <a href=https://docs.databricks.com/ja/sql/user/materialized-views.html>Databricks SQLでのマテリアライズドビューの使用</a><blockquote><p>Databricks SQL 具体化されたビューは、Databricks SQLウェアハウス、Delta Live Tables、および Databricks Runtime 11.3 以降を実行している共有クラスターからのみクエリできます。</p></blockquote></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>dlt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyspark.sql.types</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ビューを定義 (パイプライン内でのみ参照可能)</span>
</span></span><span class=line><span class=cl><span class=nd>@dlt.view</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>customers_vw</span><span class=p>():</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;csv&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>header</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>inferSchema</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/databricks-datasets/retail-org/customers/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 通常テーブルを定義 (構成すれば外部から参照可能)</span>
</span></span><span class=line><span class=cl><span class=nd>@dlt.table</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>customers_tbl</span><span class=p>():</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;csv&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>header</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>inferSchema</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;/databricks-datasets/retail-org/customers/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Streaming, Auto Loader でロードしてもテーブル生成可能</span>
</span></span><span class=line><span class=cl><span class=c1># Unity Volume から hive_metastore へのテーブル作成ではエラーが出る</span>
</span></span><span class=line><span class=cl><span class=nd>@dlt.table</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>speedtest_mat</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;header&#34;</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>schema</span><span class=p>(</span><span class=n>StructType</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;ServerID&#34;</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>(),</span> <span class=kc>False</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Sponsor&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;ServerName&#34;</span><span class=p>,</span><span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Timestamp&#34;</span><span class=p>,</span> <span class=n>TimestampType</span><span class=p>(),</span> <span class=kc>False</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Distance&#34;</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Ping&#34;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Download&#34;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Upload&#34;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]))</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>csv</span><span class=p>(</span><span class=s2>&#34;dbfs:/Volumes/hellodatabricks/default/hello-extvol/data/if-crawler/speedtest&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dlt.table</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>speedtest_aut</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>spark</span><span class=o>.</span><span class=n>readStream</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;cloudFiles&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;cloudFiles.format&#34;</span><span class=p>,</span> <span class=s2>&#34;csv&#34;</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>&#34;header&#34;</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>schema</span><span class=p>(</span><span class=n>StructType</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;ServerID&#34;</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>(),</span> <span class=kc>False</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Sponsor&#34;</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;ServerName&#34;</span><span class=p>,</span><span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Timestamp&#34;</span><span class=p>,</span> <span class=n>TimestampType</span><span class=p>(),</span> <span class=kc>False</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Distance&#34;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Ping&#34;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Download&#34;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;Upload&#34;</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>StructField</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]))</span> \
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;dbfs:/Volumes/hellodatabricks/default/hello-extvol/data/if-crawler/speedtest&#34;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- ビューを定義 (パイプライン内でのみ参照可能)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=n>LIVE</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=n>airlines_vw</span><span class=w> </span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>csv</span><span class=p>.</span><span class=o>`</span><span class=n>dbfs</span><span class=p>:</span><span class=o>/</span><span class=n>databricks</span><span class=o>-</span><span class=n>datasets</span><span class=o>/</span><span class=n>airlines</span><span class=o>/`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 通常テーブルを定義 (構成すれば外部から参照可能)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=n>LIVE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>airlines_tbl</span><span class=w> </span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>csv</span><span class=p>.</span><span class=o>`</span><span class=n>dbfs</span><span class=p>:</span><span class=o>/</span><span class=n>databricks</span><span class=o>-</span><span class=n>datasets</span><span class=o>/</span><span class=n>airlines</span><span class=o>/`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 一時テーブルを定義
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=n>TEMP</span><span class=w> </span><span class=n>LIVE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>airlines_tmp</span><span class=w> </span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>csv</span><span class=p>.</span><span class=o>`</span><span class=n>dbfs</span><span class=p>:</span><span class=o>/</span><span class=n>databricks</span><span class=o>-</span><span class=n>datasets</span><span class=o>/</span><span class=n>airlines</span><span class=o>/`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h1 id=job>Job</h1><p>使い道</p><ul><li>ワークフロー実行</li><li>Delta Live Table のロード処理</li></ul></section></article></main></div><div><footer id=site-footer class=toplevel-container><p>このサイトでは <a href=https://icons8.jp/>icons8</a> の素材を使用しています。</p><p>&copy; 2023 namoshika, All rights reserved</p></footer></div></div></body></html>