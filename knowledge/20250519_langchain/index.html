<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="概要
LangChain は LLM を活用したアプリケーションの開発を支援するフレームワークである。これを使うことで、 LLM を活用したシステムへ以下のような機能を持たせる事ができる。"><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><meta name=generator content="Hugo 0.147.7"><title>LangChain | Memo.Namo</title><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/style/main.css></head><body><div class=flexbox><div><header id=site-header class=toplevel-container><h1><a href=/>Memo.Namo</a></h1><nav><ul class=horizontal-menu><li class=horizontal-menu-item><a href=/about/>About</a></li><li class=horizontal-menu-item><a href=/knowledge/>Knowledge</a></li></ul></nav></header><main id=site-main class=toplevel-container><article class="content-container content-grid"><header class=content-grid-header><div><a class=nav-category href=/knowledge/python/>Python</a><h1 class=content-grid-title>LangChain</h1></div><p class=content-grid-desc><span>公開日: 2025-05-19</span>
<span>更新日: 2025-05-18</span></p></header><aside class=content-grid-side><div class=nav-sticky><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#概要>概要</a></li><li><a href=#1-使う準備>1. 使う準備</a></li><li><a href=#2-基本的な使い方>2. 基本的な使い方</a></li><li><a href=#3-プロンプトの組み立て>3. プロンプトの組み立て</a><ul><li><a href=#stringprompt>StringPrompt</a></li><li><a href=#messageprompt>MessagePrompt</a></li></ul></li><li><a href=#4-出力を構造化する>4. 出力を構造化する</a></li><li><a href=#5-ツールの呼び出し>5. ツールの呼び出し</a></li><li><a href=#6-埋め込み表現を取得する>6. 埋め込み表現を取得する</a></li></ul></nav><nav class=nav-tag><h2>タグ</h2><ul class=tag-container><li class="tag-item tag-item-inactive"><a href=/tags/auth/>Auth</a></li><li class="tag-item tag-item-inactive"><a href=/tags/businessman/>BusinessMan</a></li><li class="tag-item tag-item-inactive"><a href=/tags/database/>Database</a></li><li class="tag-item tag-item-inactive"><a href=/tags/dataengineering/>DataEngineering</a></li><li class="tag-item tag-item-inactive"><a href=/tags/datavisualization/>DataVisualization</a></li><li class="tag-item tag-item-inactive"><a href=/tags/devops/>DevOps</a></li><li class="tag-item tag-item-inactive"><a href=/tags/iac/>IaC</a></li><li class="tag-item tag-item-inactive"><a href=/tags/infrastructure/>Infrastructure</a></li></ul></nav></div></aside><section class="md-content content-grid-main"><h1 id=概要>概要</h1><p>LangChain は LLM を活用したアプリケーションの開発を支援するフレームワークである。これを使うことで、 LLM を活用したシステムへ以下のような機能を持たせる事ができる。</p><ul><li>データ接続: ドキュメントやAPIから情報を取得し、コンテキストに沿った応答を生成</li><li>エージェント機能: 外部ツール呼び出しを委譲し、自律的なタスク実行を実現</li><li>チェーン: 複数のLLM呼び出しと処理を直列・並列に組み合わせるワークフロー</li><li>RAG: ベクトルストア検索と生成を組み合わせ、高精度な情報提供</li></ul><h1 id=1-使う準備>1. 使う準備</h1><p>pip で導入できる。
Gemini で使うために langchain-google-genai もインストールする</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install langchain langchain-google-genai
</span></span></code></pre></div><p>Gemini の使用には API Key を要する。<br><a href=https://aistudio.google.com/>https://aistudio.google.com/</a></p><p>使用可能なモデル<br><a href=https://ai.google.dev/gemini-api/docs/models>https://ai.google.dev/gemini-api/docs/models</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_google_genai</span> <span class=kn>import</span> <span class=n>ChatGoogleGenerativeAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>GEMINI_API_KEY</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;GEMINI_API_KEY&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>llm</span> <span class=o>=</span> <span class=n>ChatGoogleGenerativeAI</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=s2>&#34;gemini-2.0-flash&#34;</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=n>GEMINI_API_KEY</span><span class=p>)</span>
</span></span></code></pre></div><h1 id=2-基本的な使い方>2. 基本的な使い方</h1><p>現状の LangChain は言語モデルの入出力を以下のように扱う。</p><ul><li>入力 &mldr; 複数メッセージ</li><li>出力 &mldr; 単一メッセージ</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.messages</span> <span class=kn>import</span> <span class=n>HumanMessage</span><span class=p>,</span> <span class=n>SystemMessage</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Type.1</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=n>SystemMessage</span><span class=p>(</span><span class=s2>&#34;アクシス教の信者として振舞ってください&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>HumanMessage</span><span class=p>(</span><span class=s2>&#34;働きたくないでござる&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>res</span><span class=o>.</span><span class=n>pretty_print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Type.2</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span><span class=p>,</span> <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=s2>&#34;アクシス教の信者として振舞ってください&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;human&#34;</span><span class=p>,</span> <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=s2>&#34;働きたくないでござる&#34;</span><span class=p>}</span>    
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>res</span><span class=o>.</span><span class=n>pretty_print</span><span class=p>()</span>
</span></span></code></pre></div><h1 id=3-プロンプトの組み立て>3. プロンプトの組み立て</h1><h2 id=stringprompt>StringPrompt</h2><p>文字列の組み立て</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>PromptTemplate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tmpl</span> <span class=o>=</span> <span class=n>PromptTemplate</span><span class=o>.</span><span class=n>from_template</span><span class=p>(</span><span class=s2>&#34;hello </span><span class=si>{name}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>tmpl</span><span class=o>.</span><span class=fm>__repr__</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>prompt</span> <span class=o>=</span> <span class=n>tmpl</span><span class=o>.</span><span class=n>invoke</span><span class=p>({</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;world&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>prompt</span><span class=o>.</span><span class=fm>__repr__</span><span class=p>())</span>
</span></span></code></pre></div><p>出力</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>PromptTemplate</span><span class=p>(</span><span class=n>input_variables</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>],</span> <span class=n>input_types</span><span class=o>=</span><span class=p>{},</span> <span class=n>partial_variables</span><span class=o>=</span><span class=p>{},</span> <span class=n>template</span><span class=o>=</span><span class=s1>&#39;hello {name}&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>StringPromptValue</span><span class=p>(</span><span class=n>text</span><span class=o>=</span><span class=s1>&#39;hello world&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=messageprompt>MessagePrompt</h2><p>文字列に加え、ロールを付与できる。
与えるプロンプトを言語モデルが開発者とユーザで区別する必要が有る場合 (チャットボットなど) に使用する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>AIMessagePromptTemplate</span><span class=p>,</span> <span class=n>HumanMessagePromptTemplate</span><span class=p>,</span> <span class=n>ChatPromptTemplate</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 入力用テンプレート (人用)</span>
</span></span><span class=line><span class=cl><span class=n>tmpl</span> <span class=o>=</span> <span class=n>HumanMessagePromptTemplate</span><span class=o>.</span><span class=n>from_template</span><span class=p>(</span><span class=s2>&#34;hello </span><span class=si>{name}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>tmpl</span><span class=o>.</span><span class=fm>__repr__</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>prompt</span> <span class=o>=</span> <span class=n>tmpl</span><span class=o>.</span><span class=n>format_messages</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&#34;world&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>prompt</span><span class=o>.</span><span class=fm>__repr__</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tmpl</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>([</span><span class=n>tmpl</span><span class=p>,</span> <span class=n>tmpl</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=c1># メッセージのリストを作る</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>tmpl</span><span class=o>.</span><span class=n>format_messages</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&#34;world&#34;</span><span class=p>)</span><span class=o>.</span><span class=fm>__repr__</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># メッセージを内包した PromptValue を作る</span>
</span></span><span class=line><span class=cl><span class=c1># to_string() で文字列に変換できる</span>
</span></span><span class=line><span class=cl><span class=n>prompt</span> <span class=o>=</span> <span class=n>tmpl</span><span class=o>.</span><span class=n>format_prompt</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&#34;world&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>prompt</span><span class=o>.</span><span class=fm>__repr__</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>prompt</span><span class=o>.</span><span class=n>to_string</span><span class=p>())</span>
</span></span></code></pre></div><p>出力</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>HumanMessagePromptTemplate</span><span class=p>(</span><span class=n>prompt</span><span class=o>=</span><span class=n>PromptTemplate</span><span class=p>(</span><span class=n>input_variables</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>],</span> <span class=n>input_types</span><span class=o>=</span><span class=p>{},</span> <span class=n>partial_variables</span><span class=o>=</span><span class=p>{},</span> <span class=n>template</span><span class=o>=</span><span class=s1>&#39;hello {name}&#39;</span><span class=p>),</span> <span class=n>additional_kwargs</span><span class=o>=</span><span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>HumanMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;hello world&#39;</span><span class=p>,</span> <span class=n>additional_kwargs</span><span class=o>=</span><span class=p>{},</span> <span class=n>response_metadata</span><span class=o>=</span><span class=p>{})]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>HumanMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;hello world&#39;</span><span class=p>,</span> <span class=n>additional_kwargs</span><span class=o>=</span><span class=p>{},</span> <span class=n>response_metadata</span><span class=o>=</span><span class=p>{}),</span> <span class=n>HumanMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;hello world&#39;</span><span class=p>,</span> <span class=n>additional_kwargs</span><span class=o>=</span><span class=p>{},</span> <span class=n>response_metadata</span><span class=o>=</span><span class=p>{})]</span>
</span></span><span class=line><span class=cl><span class=n>ChatPromptValue</span><span class=p>(</span><span class=n>messages</span><span class=o>=</span><span class=p>[</span><span class=n>HumanMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;hello world&#39;</span><span class=p>,</span> <span class=n>additional_kwargs</span><span class=o>=</span><span class=p>{},</span> <span class=n>response_metadata</span><span class=o>=</span><span class=p>{}),</span> <span class=n>HumanMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;hello world&#39;</span><span class=p>,</span> <span class=n>additional_kwargs</span><span class=o>=</span><span class=p>{},</span> <span class=n>response_metadata</span><span class=o>=</span><span class=p>{})])</span>
</span></span><span class=line><span class=cl><span class=n>Human</span><span class=p>:</span> <span class=n>hello</span> <span class=n>world</span>
</span></span><span class=line><span class=cl><span class=n>Human</span><span class=p>:</span> <span class=n>hello</span> <span class=n>world</span>
</span></span></code></pre></div><p>カスタムロールを使える場合も有る。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>ChatMessagePromptTemplate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 入力用テンプレート (カスタムロール)</span>
</span></span><span class=line><span class=cl><span class=n>tmpl</span> <span class=o>=</span> <span class=n>ChatMessagePromptTemplate</span><span class=o>.</span><span class=n>from_template</span><span class=p>(</span><span class=s2>&#34;hello </span><span class=si>{name}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>role</span><span class=o>=</span><span class=s2>&#34;cutom_role&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>tmpl</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>([</span><span class=n>tmpl</span><span class=p>,</span> <span class=n>tmpl</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>prompt</span> <span class=o>=</span> <span class=n>tmpl</span><span class=o>.</span><span class=n>format_prompt</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&#34;world&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>prompt</span><span class=o>.</span><span class=n>to_string</span><span class=p>())</span>
</span></span></code></pre></div><p>出力</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cutom_role: hello world
</span></span><span class=line><span class=cl>cutom_role: hello world
</span></span></code></pre></div><h1 id=4-出力を構造化する>4. 出力を構造化する</h1><p>LLM の出力をプログラムから扱いたい場合、オブジェクトとして構造化すると扱いやすい。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># from typing import TypedDict, Annotated</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>Field</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Hand</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>Gu</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;グー&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Choki</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;チョキ&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Pa</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;パー&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ModelResponse</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;じゃんけんで出す手を格納&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span><span class=p>:</span><span class=n>Hand</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>description</span><span class=o>=</span><span class=s2>&#34;グー、チョキ、パーの中から出した手&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TypedDict 非対応っぽい。 Pydantic が必要そう</span>
</span></span><span class=line><span class=cl><span class=c1># 参考: https://github.com/langchain-ai/langchain/issues/24225</span>
</span></span><span class=line><span class=cl><span class=n>llm</span><span class=o>.</span><span class=n>with_structured_output</span><span class=p>(</span><span class=n>ModelResponse</span><span class=p>)</span><span class=o>.</span><span class=n>invoke</span><span class=p>([</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span> <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=s2>&#34;最初はグー！じゃ～んけ～んぽん！&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span></code></pre></div><p>出力</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ModelResponse(result=&lt;Hand.Gu: &#39;グー&#39;&gt;)
</span></span></code></pre></div><h1 id=5-ツールの呼び出し>5. ツールの呼び出し</h1><p>使用できるツールの情報を与える事で LLM からツールを呼び出させる事ができる。呼び出し自体はコードを書く</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>enum</span> <span class=kn>import</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Annotated</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain.tools</span> <span class=kn>import</span> <span class=n>Tool</span><span class=p>,</span> <span class=n>tool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_weather</span><span class=p>(</span><span class=n>location</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;天気を取得する&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;晴れ&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_jancken</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;じゃんけんの出す手を取得する&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=s2>&#34;グー&#34;</span><span class=p>,</span> <span class=s2>&#34;チョキ&#34;</span><span class=p>,</span> <span class=s2>&#34;パー&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tool_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>get_weather</span><span class=p>,</span> <span class=n>get_jancken</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>tool_dict</span> <span class=o>=</span> <span class=p>{</span><span class=n>item</span><span class=o>.</span><span class=n>name</span><span class=p>:</span> <span class=n>item</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>tool_list</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>llm_binded_tools</span> <span class=o>=</span> <span class=n>llm</span><span class=o>.</span><span class=n>bind_tools</span><span class=p>(</span><span class=n>tool_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=n>llm_binded_tools</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=s2>&#34;天気を教えて。それからじゃんけんしよ！最初はグー！じゃんけんっ！&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>res</span><span class=o>.</span><span class=n>tool_calls</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tool_messages</span> <span class=o>=</span> <span class=p>[</span><span class=n>tool_dict</span><span class=p>[</span><span class=n>item</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>]]</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>item</span><span class=p>)</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>res</span><span class=o>.</span><span class=n>tool_calls</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>tool_messages</span><span class=p>)</span>
</span></span></code></pre></div><p>出力</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>ToolMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;晴れ&#39;</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;get_weather&#39;</span><span class=p>,</span> <span class=n>tool_call_id</span><span class=o>=</span><span class=s1>&#39;fe818fad-abf3-452e-9a25-53b7f766e4d4&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl> <span class=n>ToolMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;グー&#39;</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;get_jancken&#39;</span><span class=p>,</span> <span class=n>tool_call_id</span><span class=o>=</span><span class=s1>&#39;03a3e350-0401-43bc-840b-117a89c2720a&#39;</span><span class=p>)]</span>
</span></span></code></pre></div><h1 id=6-埋め込み表現を取得する>6. 埋め込み表現を取得する</h1><p>AWS Bedrock で提供されている多言語埋め込みモデルを使う。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Gemini Embedding はまだプレビューであるため、 AWS Bedrock を使う。</span>
</span></span><span class=line><span class=cl>pip install langchain-aws
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_aws.embeddings</span> <span class=kn>import</span> <span class=n>BedrockEmbeddings</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>AWS_ACCESS_KEY_ID</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;AWS_ACCESS_KEY_ID&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>AWS_SECRET_ACCESS_KEY</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;AWS_SECRET_ACCESS_KEY&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>AWS_DEFAULT_REGION</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;AWS_DEFAULT_REGION&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>embmodel</span> <span class=o>=</span> <span class=n>BedrockEmbeddings</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>model_id</span><span class=o>=</span><span class=s2>&#34;amazon.titan-embed-text-v2:0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>aws_access_key_id</span><span class=o>=</span><span class=n>AWS_ACCESS_KEY_ID</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>aws_secret_access_key</span><span class=o>=</span><span class=n>AWS_SECRET_ACCESS_KEY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>region_name</span><span class=o>=</span><span class=n>AWS_DEFAULT_REGION</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=n>embmodel</span><span class=o>.</span><span class=n>embed_query</span><span class=p>(</span><span class=s2>&#34;hoge&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>res</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span>
</span></span></code></pre></div></section></article></main></div><div><footer id=site-footer class=toplevel-container><p>このサイトでは <a href=https://icons8.jp/>icons8</a> の素材を使用しています。</p><p>&copy; 2025 namoshika, All rights reserved</p></footer></div></div></body></html>