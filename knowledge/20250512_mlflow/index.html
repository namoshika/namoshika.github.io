<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="概要
MLflowは機械学習モデルの開発からデプロイまでのライフサイクルを一貫して管理するためのオープンソースプラットフォーム。以下のような機能によって、 MLOps のワークフローをシンプルにする事ができる。"><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><meta name=generator content="Hugo 0.147.3"><title>MLflow | Memo.Namo</title>
<meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/style/main.css></head><body><div class=flexbox><div><header id=site-header class=toplevel-container><h1><a href=/>Memo.Namo</a></h1><nav><ul class=horizontal-menu><li class=horizontal-menu-item><a href=/about/>About</a></li><li class=horizontal-menu-item><a href=/knowledge/>Knowledge</a></li></ul></nav></header><main id=site-main class=toplevel-container><article class="content-container content-grid"><header class=content-grid-header><div><a class=nav-category href=/knowledge/python/>Python</a><h1 class=content-grid-title>MLflow</h1></div><p class=content-grid-desc><span>公開日: 2025-05-12</span>
<span>更新日: 2025-05-18</span></p></header><aside class=content-grid-side><div class=nav-sticky><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#概要>概要</a></li><li><a href=#主なコンポーネント>主なコンポーネント</a></li><li><a href=#アーキテクチャ>アーキテクチャ</a></li><li><a href=#使ってみる>使ってみる</a></li><li><a href=#tracking>Tracking</a><ul><li><a href=#モデルを記録>モデルを記録</a></li><li><a href=#エクスポート--インポート>エクスポート & インポート</a></li></ul></li><li><a href=#model>Model</a></li><li><a href=#model-registry>Model Registry</a><ul><li><a href=#レジストリへ登録>レジストリへ登録</a></li><li><a href=#レジストリから取得>レジストリから取得</a></li></ul></li></ul></nav><nav class=nav-tag><h2>タグ</h2><ul class=tag-container><li class="tag-item tag-item-inactive"><a href=/tags/auth/>Auth</a></li><li class="tag-item tag-item-inactive"><a href=/tags/businessman/>BusinessMan</a></li><li class="tag-item tag-item-inactive"><a href=/tags/database/>Database</a></li><li class="tag-item tag-item-inactive"><a href=/tags/dataengineering/>DataEngineering</a></li><li class="tag-item tag-item-inactive"><a href=/tags/datavisualization/>DataVisualization</a></li><li class="tag-item tag-item-inactive"><a href=/tags/devops/>DevOps</a></li><li class="tag-item tag-item-inactive"><a href=/tags/iac/>IaC</a></li><li class="tag-item tag-item-inactive"><a href=/tags/infrastructure/>Infrastructure</a></li></ul></nav></div></aside><section class="md-content content-grid-main"><h1 id=概要>概要</h1><p>MLflowは機械学習モデルの開発からデプロイまでのライフサイクルを一貫して管理するためのオープンソースプラットフォーム。以下のような機能によって、 MLOps のワークフローをシンプルにする事ができる。</p><ul><li><strong>効率的な実験管理</strong>：実験を一元管理し、最適な設定を可視化･比較</li><li><strong>再現性の確保</strong>：依存関係やコードを管理し、誰でも同じ結果を再現</li><li><strong>チーム開発の強化</strong>：Model Registry によるバージョン管理で、複数人でも混乱なくモデルを運用</li></ul><p>主な特徴として、実験結果の追跡（Tracking）、プロジェクトの再現性確保（Projects）、モデルのパッケージ化とデプロイ（Models）、モデルバージョン管理（Model Registry）という4つのコアコンポーネントを提供し、あらゆるMLライブラリやデプロイ環境と連携が可能。</p><h1 id=主なコンポーネント>主なコンポーネント</h1><ol><li><p><strong>MLflow Tracking</strong></p><ul><li>パラメータ、メトリクス、成果物（モデルファイルなど）を記録</li><li>Web UI で複数の実験を比較・フィルタリング可能</li></ul></li><li><p><strong>MLflow Projects</strong></p><ul><li>MLproject ファイルで依存関係を宣言</li><li>Conda／Docker と連携し、誰でも同じ環境で実行できる</li></ul></li><li><p><strong>MLflow Models</strong></p><ul><li>訓練済みモデルを標準フォーマットで保存</li><li>Docker、SageMaker、Azure ML などへワンクリックでデプロイ</li></ul></li><li><p><strong>MLflow Model Registry</strong></p><ul><li>モデルのバージョン管理</li><li>ステージング→本番への昇格やロールバックをサポート</li><li>コメントやタグで開発チーム内の共有が容易</li></ul></li></ol><h1 id=アーキテクチャ>アーキテクチャ</h1><ul><li><p><strong>サーバー／クライアント構成</strong></p><ul><li>サーバーは任意のデータベース（MySQL、PostgreSQL、SQLite 等）に実験情報を保存</li><li>オブジェクトストレージ（S3、Azure Blob Storage 等）に成果物を保管</li></ul></li><li><p><strong>拡張性</strong></p><ul><li>REST API 経由で新しいバックエンドや認証方式をプラグインとして追加可能</li></ul></li></ul><h1 id=使ってみる>使ってみる</h1><p>pip でインストールして使う。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=err>$</span> <span class=n>pip</span> <span class=n>install</span> <span class=n>mlflow</span>
</span></span><span class=line><span class=cl><span class=err>$</span> <span class=n>mlflow</span> <span class=n>server</span>
</span></span></code></pre></div><p>開発環境からは MLflow のトラッキングサーバーを指定して使う。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>mlflow</span>
</span></span><span class=line><span class=cl><span class=n>mlflow</span><span class=o>.</span><span class=n>set_tracking_uri</span><span class=p>(</span><span class=s2>&#34;http://localhost:5000&#34;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># デモ用にアイリスのデータセット用の分類器を設定する</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.datasets</span> <span class=kn>import</span> <span class=n>load_iris</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>train_test_split</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>LogisticRegression</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>accuracy_score</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. Load the iris dataset</span>
</span></span><span class=line><span class=cl><span class=n>iris</span> <span class=o>=</span> <span class=n>load_iris</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>iris</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=n>iris</span><span class=o>.</span><span class=n>target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. Split into training and testing datasets</span>
</span></span><span class=line><span class=cl><span class=n>x_train</span><span class=p>,</span> <span class=n>x_test</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>y_test</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>test_size</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. Train a logistic regression classifier</span>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>LogisticRegression</span><span class=p>(</span><span class=n>max_iter</span><span class=o>=</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>model</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. Evaluate accuracy on the test dataset</span>
</span></span><span class=line><span class=cl><span class=n>y_pred</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>accuracy</span> <span class=o>=</span> <span class=n>accuracy_score</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Accuracy: </span><span class=si>{</span><span class=n>accuracy</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h1 id=tracking>Tracking</h1><h2 id=モデルを記録>モデルを記録</h2><p>記録は、 <code>mlflow.start_run()</code> を使って実験用の枠内で行う。</p><p>MLflow では、主要ライブラリ向けに &ldquo;フレーバー&rdquo; と呼ばれるモデル記録用インターフェース (<code>mlflow.(フレーバー).～</code>) が用意されている。また、未対応ライブラリには “Models From Code” が使える。</p><p>以前は <code>mlflow.pyfunc.PythonModel</code> を継承した方法も有ったが、現在は非推奨。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>mlflow</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 実験枠を作成</span>
</span></span><span class=line><span class=cl><span class=n>mlflow</span><span class=o>.</span><span class=n>set_experiment</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;MLflow&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>mlflow</span><span class=o>.</span><span class=n>start_run</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>signature</span> <span class=o>=</span> <span class=n>mlflow</span><span class=o>.</span><span class=n>models</span><span class=o>.</span><span class=n>infer_signature</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>model_info_1</span> <span class=o>=</span> <span class=n>mlflow</span><span class=o>.</span><span class=n>sklearn</span><span class=o>.</span><span class=n>log_model</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=s2>&#34;model&#34;</span><span class=p>,</span> <span class=n>signature</span><span class=o>=</span><span class=n>signature</span><span class=p>,</span> <span class=n>input_example</span><span class=o>=</span><span class=n>x_train</span><span class=p>[:</span><span class=mi>10</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 情報を記録</span>
</span></span><span class=line><span class=cl>    <span class=n>mlflow</span><span class=o>.</span><span class=n>log_params</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>get_params</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>mlflow</span><span class=o>.</span><span class=n>log_input</span><span class=p>(</span><span class=n>mlflow</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>from_numpy</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span> <span class=n>source</span><span class=o>=</span><span class=s2>&#34;iris&#34;</span><span class=p>),</span> <span class=n>context</span><span class=o>=</span><span class=s2>&#34;Train&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>mlflow</span><span class=o>.</span><span class=n>log_metric</span><span class=p>(</span><span class=s2>&#34;accuracy&#34;</span><span class=p>,</span> <span class=n>model</span><span class=o>.</span><span class=n>score</span><span class=p>(</span><span class=n>x_test</span><span class=p>,</span> <span class=n>y_test</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>mlflow</span><span class=o>.</span><span class=n>set_tag</span><span class=p>(</span><span class=s2>&#34;sample-tag&#34;</span><span class=p>,</span> <span class=s2>&#34;hello MLflow&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=エクスポート--インポート>エクスポート & インポート</h2><p>ローカルへモデルを書き出したり、他所から取ってきたモデルを取り込むことも可能。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># トラッキング記録からモデルを取得</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>model_info_1</span><span class=o>.</span><span class=n>model_uri</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>model_1</span> <span class=o>=</span> <span class=n>mlflow</span><span class=o>.</span><span class=n>sklearn</span><span class=o>.</span><span class=n>load_model</span><span class=p>(</span><span class=n>model_info_1</span><span class=o>.</span><span class=n>model_uri</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># モデルを手元へエクスポート (アーティファクトから. 方法1)</span>
</span></span><span class=line><span class=cl><span class=c1># mlflow.artifacts.download_artifacts(&#34;dbfs:/databricks/mlflow-tracking/1478265101077117/646f425ef1014acd8b78303e241995a2/artifacts/model&#34;, dst_path=&#34;exported&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># モデルを手元へエクスポート (アーティファクトから. 方法2)</span>
</span></span><span class=line><span class=cl><span class=n>mlflow</span><span class=o>.</span><span class=n>artifacts</span><span class=o>.</span><span class=n>download_artifacts</span><span class=p>(</span><span class=n>model_info_1</span><span class=o>.</span><span class=n>model_uri</span><span class=p>,</span> <span class=n>dst_path</span><span class=o>=</span><span class=s2>&#34;exported&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># モデルを手元へエクスポート (インスタンスから)</span>
</span></span><span class=line><span class=cl><span class=n>mlflow</span><span class=o>.</span><span class=n>sklearn</span><span class=o>.</span><span class=n>save_model</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=p>,</span> <span class=s2>&#34;exported/saved_model&#34;</span><span class=p>,</span> <span class=n>signature</span><span class=o>=</span><span class=n>signature</span><span class=p>,</span> <span class=n>input_example</span><span class=o>=</span><span class=n>x_train</span><span class=p>[:</span><span class=mi>10</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># モデルを手元からインポート</span>
</span></span><span class=line><span class=cl><span class=n>model_1</span> <span class=o>=</span> <span class=n>mlflow</span><span class=o>.</span><span class=n>pyfunc</span><span class=o>.</span><span class=n>load_model</span><span class=p>(</span><span class=s2>&#34;exported/model/&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h1 id=model>Model</h1><p>機械学習モデルを様々なツールで利用できるようパッケージ化するための標準フォーマット。モデルの入出力の形式・サンプルやライブラリ依存関係をモデルと共に保存する。</p><p>パッケージは <code>MLmodel</code> ファイル (中身は YAML) をルートに持つディレクトリとして表現される。パッケージングは各フレーバーから提供される機能から行えるため、直接作る必要は無い。</p><h1 id=model-registry>Model Registry</h1><p>モデルのライフサイクル管理向け機能を提供。モデルへ名前を付けて登録し、バージョン管理が出来る。モデルは既定では Unity Catalog へ保存される。</p><h2 id=レジストリへ登録>レジストリへ登録</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># モデル登録 (uri: runs:/646f425ef1014acd8b78303e241995a2/model)</span>
</span></span><span class=line><span class=cl><span class=n>model_ver_1</span> <span class=o>=</span> <span class=n>mlflow</span><span class=o>.</span><span class=n>register_model</span><span class=p>(</span><span class=n>model_info_1</span><span class=o>.</span><span class=n>model_uri</span><span class=p>,</span> <span class=s2>&#34;iris-estimator-1&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=レジストリから取得>レジストリから取得</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>model_1</span> <span class=o>=</span> <span class=n>mlflow</span><span class=o>.</span><span class=n>sklearn</span><span class=o>.</span><span class=n>load_model</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;models:/iris-estimator-1/</span><span class=si>{</span><span class=n>model_ver_1</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>mlflow</span> <span class=kn>import</span> <span class=n>MlflowClient</span>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>MlflowClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># モデルへエイリアス割り当て</span>
</span></span><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>set_registered_model_alias</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;iris-estimator-1&#34;</span><span class=p>,</span> <span class=s2>&#34;confirmed&#34;</span><span class=p>,</span> <span class=n>model_ver_1</span><span class=o>.</span><span class=n>version</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># エイリアスでモデル取得</span>
</span></span><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>get_model_version_by_alias</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;iris-estimator-1&#34;</span><span class=p>,</span> <span class=s2>&#34;confirmed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># モデルからエイリアス削除</span>
</span></span><span class=line><span class=cl><span class=c1># client.delete_registered_model_alias(&#34;iris-estimator-1&#34;, &#34;confirmed&#34;)</span>
</span></span></code></pre></div></section></article></main></div><div><footer id=site-footer class=toplevel-container><p>このサイトでは <a href=https://icons8.jp/>icons8</a> の素材を使用しています。</p><p>&copy; 2025 namoshika, All rights reserved</p></footer></div></div></body></html>