<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="psql -h localhost -p 5432 -U postgres -d postgres Database テンプレートを指定しない場合は template1 から作られる。 # create db createdb {DB_NAME} -T template1 # modify db # (empty) # list db psql -l # switch db psql -d {DB_NAME} # drop db dropdb {DB_NAME} -- create db create database {DB_NAME} with template template1"><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><meta name=generator content="Hugo 0.128.2"><title>Postgres 備忘録 | Memo.Namo</title>
<meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/style/main.css></head><body><div class=flexbox><div><header id=site-header class=toplevel-container><h1><a href=/>Memo.Namo</a></h1><nav><ul class=horizontal-menu><li class=horizontal-menu-item><a href=/about/>About</a></li><li class=horizontal-menu-item><a href=/knowledge/>Knowledge</a></li></ul></nav></header><main id=site-main class=toplevel-container><article class="content-container content-grid"><header class=content-grid-header><div><h1 class=content-grid-title>Postgres 備忘録</h1></div><p class=content-grid-desc><span>公開日: 2022-11-16</span>
<span>更新日: 2024-07-14</span></p></header><aside class=content-grid-side><div class=nav-sticky><h2>目次</h2><nav id=TableOfContents><ul><li><a href=#database>Database</a></li><li><a href=#schema>Schema</a></li><li><a href=#table>Table</a></li><li><a href=#role>Role</a></li><li><a href=#domain>Domain</a></li><li><a href=#database-cluster>Database Cluster</a></li><li><a href=#admin-tools>Admin Tools</a><ul><li><a href=#pg_ctl>pg_ctl</a></li><li><a href=#psql>psql</a></li></ul></li><li><a href=#setting-file>Setting file</a><ul><li><a href=#設定反映のタイミング>設定反映のタイミング</a></li><li><a href=#listen_address>listen_address</a></li><li><a href=#port>port</a></li><li><a href=#max_connections>max_connections</a></li><li><a href=#search_path>search_path</a></li><li><a href=#default_transaction_isolation>default_transaction_isolation</a></li><li><a href=#client_encoding>client_encoding</a></li><li><a href=#log_destination>log_destination</a></li><li><a href=#logging_collector>logging_collector</a></li><li><a href=#log_directory>log_directory</a></li><li><a href=#log_filename>log_filename</a></li><li><a href=#log_min_message>log_min_message</a></li><li><a href=#log_line_prefix>log_line_prefix</a></li></ul></li><li><a href=#sql-dml>SQL (DML)</a><ul><li><a href=#各構文>各構文</a></li><li><a href=#データ型>データ型</a></li></ul></li><li><a href=#sql-ddl>SQL (DDL)</a><ul><li><a href=#table-1>Table</a></li><li><a href=#sequence>Sequence</a></li><li><a href=#view>View</a></li><li><a href=#index>Index</a></li><li><a href=#function--procedure>Function / Procedure</a></li><li><a href=#aggregate-number>Aggregate (number)</a></li><li><a href=#aggregate-text>Aggregate (text)</a></li><li><a href=#aggregate-date>Aggregate (date)</a></li></ul></li></ul></nav><nav class=nav-tag><h2>タグ</h2><ul class=tag-container><li class="tag-item tag-item-inactive"><a href=/tags/auth/>Auth</a></li><li class="tag-item tag-item-inactive"><a href=/tags/businessman/>BusinessMan</a></li><li class="tag-item tag-item-inactive"><a href=/tags/database/>Database</a></li><li class="tag-item tag-item-inactive"><a href=/tags/dataengineering/>DataEngineering</a></li><li class="tag-item tag-item-inactive"><a href=/tags/datavisualization/>DataVisualization</a></li><li class="tag-item tag-item-inactive"><a href=/tags/devops/>DevOps</a></li><li class="tag-item tag-item-inactive"><a href=/tags/iac/>IaC</a></li><li class="tag-item tag-item-inactive"><a href=/tags/infrastructure/>Infrastructure</a></li></ul></nav></div></aside><section class="md-content content-grid-main"><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>psql -h localhost -p <span class=m>5432</span> -U postgres -d postgres
</span></span></code></pre></div><h1 id=database>Database</h1><p>テンプレートを指定しない場合は template1 から作られる。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># create db</span>
</span></span><span class=line><span class=cl>createdb <span class=o>{</span>DB_NAME<span class=o>}</span> -T template1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># modify db</span>
</span></span><span class=line><span class=cl><span class=c1># (empty)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># list db</span>
</span></span><span class=line><span class=cl>psql -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># switch db</span>
</span></span><span class=line><span class=cl>psql -d <span class=o>{</span>DB_NAME<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># drop db</span>
</span></span><span class=line><span class=cl>dropdb <span class=o>{</span>DB_NAME<span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- create db
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=err>{</span><span class=n>DB_NAME</span><span class=err>}</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=k>template</span><span class=w> </span><span class=n>template1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- modify db
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>alter</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=err>{</span><span class=n>DB_NAME_OLD</span><span class=err>}</span><span class=w> </span><span class=k>rename</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=err>{</span><span class=n>DB_NAME_NEW</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- list db
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>\</span><span class=n>l</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- switch db
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>\</span><span class=k>c</span><span class=w> </span><span class=err>{</span><span class=n>DB_NAME</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- drop db
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>drop</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=err>{</span><span class=n>DB_NAME</span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><h1 id=schema>Schema</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- create db
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>schema</span><span class=w> </span><span class=err>{</span><span class=k>SCHEMA_NAME</span><span class=err>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- modify db
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>alter</span><span class=w> </span><span class=k>schema</span><span class=w> </span><span class=err>{</span><span class=n>SCHEMA_OLD</span><span class=err>}</span><span class=w> </span><span class=k>rename</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=err>{</span><span class=n>SCHEMA_NEW</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- list db
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>\</span><span class=n>dn</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- drop db
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>drop</span><span class=w> </span><span class=k>schema</span><span class=w> </span><span class=err>{</span><span class=n>SCHEMA_OLD</span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><h1 id=table>Table</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- create table
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>TABLE_NAME</span><span class=err>}</span><span class=w> </span><span class=p>(</span><span class=n>column1</span><span class=w> </span><span class=nb>integer</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>123</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- modify table
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sample_table</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=n>col1</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>123</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- list table
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>\</span><span class=n>d</span><span class=p>,</span><span class=w> </span><span class=err>\</span><span class=n>dt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- drop table
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>TABLE_NAME</span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><h1 id=role>Role</h1><p>データベースクラスタの中で同名ユーザの作成は不可。<br>データベースクラスタを生成時のOSユーザ名でスーパーユーザが生成される</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># create user</span>
</span></span><span class=line><span class=cl>createuser <span class=o>{</span>USER_NAME<span class=o>}</span> -l -d -r -s -P
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- create user
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>role</span><span class=w> </span><span class=err>{</span><span class=n>USERNAME</span><span class=err>}</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>LOGIN</span><span class=w> </span><span class=n>PASSWORD</span><span class=w> </span><span class=s1>&#39;passwd&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--list user
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>\</span><span class=n>du</span><span class=w>
</span></span></span></code></pre></div><h1 id=domain>Domain</h1><p>制約などを付与した型として使用可能。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>domain</span><span class=w> </span><span class=err>{</span><span class=n>DOMAIN_NAME</span><span class=err>}</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nb>integer</span><span class=w> </span><span class=k>check</span><span class=w> </span><span class=p>(</span><span class=n>VALUE</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>5</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h1 id=database-cluster>Database Cluster</h1><p>postgre はサーバープロセス1つに対して <code>$PGDATA</code> のディレクトリを1つを持つ。<br>データベースは <code>$PGDATA/base</code> の中にデータベースのOIDが名前となったディレクトリとして格納される。<br>エンコーディング指定はデータベースとクライアントで異なる事に注意。</p><table><thead><tr><th>Encoding</th><th>Database Encoding</th><th>Client Encoding</th></tr></thead><tbody><tr><td>UTF8</td><td>OK</td><td>OK</td></tr><tr><td>EUC_JP</td><td>OK</td><td>OK</td></tr><tr><td>SJIS</td><td>NG</td><td>OK</td></tr></tbody></table><p>データベースクラスタは <code>initdb</code> で作る。特にソースコードからビルドした際には <code>initdb</code> で作る必要が有る。このコマンドはホストからのみ実行可能。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>useradd -M pst
</span></span><span class=line><span class=cl>mkdir /var/dbcl
</span></span><span class=line><span class=cl>chown pst:pst /var/dbcl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -D, --pgdata {DIRECTORY}</span>
</span></span><span class=line><span class=cl><span class=c1># -E, --encoding {ex: utf8, euc_jp}</span>
</span></span><span class=line><span class=cl><span class=c1># -U, --username {USERNAME}</span>
</span></span><span class=line><span class=cl><span class=c1># --no-locale</span>
</span></span><span class=line><span class=cl>initdb -D /var/dbcl/ -E utf8 --no-locale -U pst
</span></span></code></pre></div><h1 id=admin-tools>Admin Tools</h1><h2 id=pg_ctl>pg_ctl</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pg_ctl initdb -D<span class=p>|</span>--pgdata <span class=o>{</span>DB_CLUSTER_DIR<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pg_ctl start -D<span class=p>|</span>--pgdata <span class=o>{</span>DB_CLUSTER_DIR<span class=o>}</span> -t <span class=o>{</span>MAX_WAIT_TIME: 60sec<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -m</span>
</span></span><span class=line><span class=cl><span class=c1>#   * smart:     クライアントからの接続が全て切断されるまで待つ</span>
</span></span><span class=line><span class=cl><span class=c1>#   * fast:      クライアントからの接続を即遮断. 実行中トランザクションは全てロールバック</span>
</span></span><span class=line><span class=cl><span class=c1>#   * immediate: クリーンアップ処理を行わずに停止. クラッシュ相当の状態</span>
</span></span><span class=line><span class=cl><span class=c1># -t</span>
</span></span><span class=line><span class=cl><span class=c1>#   待ち時間 (単位: 秒. 既定: 60sec)</span>
</span></span><span class=line><span class=cl><span class=c1># -W</span>
</span></span><span class=line><span class=cl><span class=c1>#   待たずに制御を戻す</span>
</span></span><span class=line><span class=cl>pg_ctl stop -D<span class=p>|</span>--pgdata <span class=o>{</span>DB_CLUSTER_DIR<span class=o>}</span> -t -m s<span class=o>[</span>mart<span class=o>]</span><span class=p>|</span>f<span class=o>[</span>ast<span class=o>]</span><span class=p>|</span>i<span class=o>[</span>mmediate<span class=o>]</span> -W
</span></span><span class=line><span class=cl>pg_ctl restart <span class=o>(</span>stop と同一<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 設定ファイルの再読み込み</span>
</span></span><span class=line><span class=cl>pg_ctl reload -D<span class=p>|</span>--pgdata
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 起動状態</span>
</span></span><span class=line><span class=cl>pg_ctl status
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># プロセス終了</span>
</span></span><span class=line><span class=cl>pg_ctl <span class=nb>kill</span> TERM<span class=p>|</span>INT<span class=p>|</span>QUIT<span class=p>|</span>HUP <span class=o>{</span>PID<span class=o>}</span>
</span></span></code></pre></div><h2 id=psql>psql</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 接続</span>
</span></span><span class=line><span class=cl>psql -h<span class=p>|</span>--host <span class=o>{</span>HOST<span class=o>}</span> -p<span class=p>|</span>--port <span class=o>{</span>PORT<span class=o>}</span> -U<span class=p>|</span>--user <span class=o>{</span>USER<span class=o>}</span>
</span></span></code></pre></div><h1 id=setting-file>Setting file</h1><p>設定値には型が有る (boolean, integer, floating point, string, enum)
boolean には on/off/true/false/yes/no/1/0 が指定可能
一部の設定値には単位を指定可能 (メモリ: kB/MB/GB, 時間: ms/s/min/h/d)</p><h2 id=設定反映のタイミング>設定反映のタイミング</h2><table><thead><tr><th>種別</th><th>restart</th><th>pg_ctl reload</th><th>suset</th><th>set</th></tr></thead><tbody><tr><td>不可</td><td>x</td><td>x</td><td>x</td><td>x</td></tr><tr><td>起動 (postmaster)</td><td>o</td><td>x</td><td>x</td><td>x</td></tr><tr><td>再読み込み (sighup)</td><td>o</td><td>o</td><td>x</td><td>x</td></tr><tr><td>スーパーユーザのみ (suset)</td><td>o</td><td>o</td><td>o</td><td>x</td></tr><tr><td>いつでも (user)</td><td>o</td><td>o</td><td>o</td><td>o</td></tr></tbody></table><h2 id=listen_address>listen_address</h2><p>サーバー側の ip アドレス (カンマで複数指定可能)。クライアントから宛先未設定の接続を試みられても応答はしない。</p><ul><li>デフォルト値: localhost</li><li>反映: 起動時</li></ul><h2 id=port>port</h2><p>受け付けるポート番号</p><ul><li>デフォルト値: 5432</li><li>反映: 起動</li></ul><h2 id=max_connections>max_connections</h2><p>最大同時接続数</p><ul><li>デフォルト値: 100</li><li>反映: 起動</li></ul><h2 id=search_path>search_path</h2><p>スキーマ検索パス</p><ul><li>デフォルト値: &ldquo;$user&rdquo;,public</li><li>反映: 何時でも誰でも</li></ul><h2 id=default_transaction_isolation>default_transaction_isolation</h2><p>トランザクションの分離レベル</p><ul><li>型: read uncommitted, read committed, repeatable read, serializable</li><li>デフォルト値: read committed</li><li>反映: 何時でも誰でも</li></ul><h2 id=client_encoding>client_encoding</h2><p>クライアントエンコーディングを指定</p><ul><li>デフォルト値: SQL_ASCII</li><li>反映: 何時でも誰でも</li></ul><h2 id=log_destination>log_destination</h2><p>ログの保存先。カンマで複数指定可能</p><ul><li>型: stderr, csvlog, syslog, eventlog</li><li>デフォルト値: stderr</li><li>反映: reload</li></ul><p>出力先</p><ul><li>stderr: 標準エラー出力</li><li>csvlog: CSV形式で stderr へ出力。設定の logging_collector を on にする必要有り</li><li>syslog: syslog へ出力</li><li>eventlog: イベントログへ出力 (windows 用)</li></ul><h2 id=logging_collector>logging_collector</h2><p>ログをファイルに出力する</p><ul><li>デフォルト値: off</li><li>反映: 起動時</li></ul><h2 id=log_directory>log_directory</h2><p>ログ出力ディレクトリを指定。絶対パスか <code>$PGDATA</code> からの相対パスで指定。</p><ul><li>デフォルト値: log (<code>$PGDATA/log</code>)</li><li>反映: reload</li></ul><h2 id=log_filename>log_filename</h2><p>ログファイル名を指定</p><ul><li>デフォルト値: postgresql-%Y-%m-%d_%H%M%S.log</li><li>反映: reload</li></ul><h2 id=log_min_message>log_min_message</h2><p>ログレベルの指定</p><ul><li>型: PANIC, FATAL, LOG, ERROR, WARNING etc</li><li>デフォルト値: WARNING</li><li>反映: suset</li></ul><p>ログレベル</p><ul><li>PANIC: 致命的。全てのセッションが強制切断。PostgreSQL 停止。</li><li>FATAL: 特定のセッションで問題発生。対象セッションのみ切断</li><li>LOG: 管理者が着目すべき動作ログ</li><li>ERROR: 特定のトランザクションで問題発生。対象トランザクションのみロールバック</li><li>WARNING: 想定外の動作に対する警告メッセージ</li></ul><h2 id=log_line_prefix>log_line_prefix</h2><p>ログの行頭を指定</p><ul><li>デフォルト値: <code>%m [%p]</code></li><li>反映: reload</li></ul><p>使用可能な変数</p><ul><li>%u: データベースユーザ名</li><li>%d: データベース名</li><li>%p: プロセス名</li><li>%t: タイムスタンプ</li><li>%m: ミリ秒タイムスタンプ</li><li>%%: %文字そのもの</li></ul><h1 id=sql-dml>SQL (DML)</h1><h2 id=各構文>各構文</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 基本クエリ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>distinct</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=p>(</span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=p>)</span><span class=w> </span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=w> </span><span class=p>[</span><span class=k>as</span><span class=p>]</span><span class=w> </span><span class=err>{</span><span class=n>alternative_column_name</span><span class=err>}</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w>  </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=err>{</span><span class=n>condition</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>having</span><span class=w> </span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=w> </span><span class=err>{</span><span class=k>asc</span><span class=o>|</span><span class=k>desc</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>offset</span><span class=w> </span><span class=err>{</span><span class=n>num</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>limit</span><span class=w> </span><span class=err>{</span><span class=n>num</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 結合
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=k>inner</span><span class=p>]</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=err>{</span><span class=n>expression</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=k>inner</span><span class=p>]</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>using</span><span class=w> </span><span class=err>{</span><span class=k>column</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>natural</span><span class=w> </span><span class=p>[</span><span class=k>inner</span><span class=p>]</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>cross</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>{</span><span class=k>left</span><span class=o>|</span><span class=k>right</span><span class=o>|</span><span class=k>full</span><span class=err>}</span><span class=w> </span><span class=p>[</span><span class=k>outer</span><span class=p>]</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=err>{</span><span class=n>expression</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 条件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>where</span><span class=w> </span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=w> </span><span class=p>[</span><span class=k>not</span><span class=p>]</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=err>{</span><span class=n>value</span><span class=err>}</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>any</span><span class=w> </span><span class=p>(</span><span class=n>query</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=w> </span><span class=k>between</span><span class=w> </span><span class=err>{</span><span class=k>from</span><span class=err>}</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=err>{</span><span class=k>to</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=p>[</span><span class=k>not</span><span class=p>]</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=p>(</span><span class=n>query</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 集合演算
</span></span></span><span class=line><span class=cl><span class=c1>-- 優先度は通常の論理演算と同じ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>query</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=k>union</span><span class=o>|</span><span class=k>except</span><span class=o>|</span><span class=k>intersect</span><span class=p>][</span><span class=k>all</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>query</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 更新
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=p>(</span><span class=err>{</span><span class=n>column1</span><span class=err>}</span><span class=p>,</span><span class=w> </span><span class=err>{</span><span class=n>column2</span><span class=err>}</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=err>{</span><span class=n>value1</span><span class=err>}</span><span class=p>,</span><span class=w> </span><span class=err>{</span><span class=n>value1</span><span class=err>}</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=err>{</span><span class=n>value2</span><span class=err>}</span><span class=p>,</span><span class=w> </span><span class=err>{</span><span class=n>value2</span><span class=err>}</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>update</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=err>{</span><span class=n>column_name1</span><span class=err>}</span><span class=o>=</span><span class=err>{</span><span class=n>value1</span><span class=err>}</span><span class=p>,</span><span class=w> </span><span class=err>{</span><span class=n>column_name2</span><span class=err>}</span><span class=o>=</span><span class=err>{</span><span class=n>value2</span><span class=err>}</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=err>{</span><span class=n>expression</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>delete</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=err>{</span><span class=n>expression</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 配列
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>array_table</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=w> </span><span class=nb>text</span><span class=p>[],</span><span class=w> </span><span class=n>c2</span><span class=w> </span><span class=nb>int</span><span class=p>[])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>array_table</span><span class=p>(</span><span class=n>c1</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=s1>&#39;(1, 2, 3)&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>c1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>array_table</span><span class=p>;</span><span class=w> </span><span class=c1>-- インデックスは1始まり
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=n>c1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>array_table</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>any</span><span class=p>(</span><span class=n>c1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- キャスト
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s1>&#39;{table_name}&#39;</span><span class=p>::</span><span class=n>regclass</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>cast</span><span class=p>(</span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nb>integer</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=p>::</span><span class=nb>int</span><span class=w>
</span></span></span></code></pre></div><h2 id=データ型>データ型</h2><p>interval で複数形するか否かは自由。</p><table><thead><tr><th>type</th><th>size</th><th>range</th></tr></thead><tbody><tr><td>smallint</td><td>2 byte</td><td>-3万～3万</td></tr><tr><td>integer, int</td><td>4 byte</td><td>-2億～2億</td></tr><tr><td>bigint</td><td>8 byte</td><td>デカい</td></tr><tr><td>decimal, numeric</td><td>variable</td><td>そこそこ</td></tr><tr><td>real</td><td>variable</td><td>そこそこ</td></tr><tr><td>double precision</td><td>8 byte</td><td>15桁</td></tr><tr><td>smallserial</td><td>2 byte</td><td>1～3万</td></tr><tr><td>serial</td><td>4 byte</td><td>1～2億</td></tr><tr><td>bigserial</td><td>8 byte</td><td>デカい</td></tr><tr><td>char(n), character(n)</td><td>variable</td><td>空白で埋められた固定長</td></tr><tr><td>varchar(n), character varying(n)</td><td>variable</td><td>可変長文字列</td></tr><tr><td>text</td><td>variable</td><td>可変長文字列</td></tr><tr><td>bytea</td><td>variable</td><td>バイナリ</td></tr><tr><td>timestamp [without time zone]</td><td>8 byte</td><td></td></tr><tr><td>timestamp with timezone</td><td>8 byte</td><td></td></tr><tr><td>date</td><td>4 byte</td><td></td></tr><tr><td>time [without time zone]</td><td>8 byte</td><td></td></tr><tr><td>time with time zone</td><td>12 byte</td><td></td></tr><tr><td>interval &lsquo;{num} {year|month|day|hour|minute}&rsquo;</td><td>16 byte</td><td>e.g. &lsquo;1 hours 30 minutes&rsquo;</td></tr><tr><td>boolean</td><td>1 byte</td><td>{t|&lsquo;true&rsquo;|&lsquo;y&rsquo;|&lsquo;yes&rsquo;|&lsquo;on&rsquo;|&lsquo;1&rsquo;|TRUE}</td></tr></tbody></table><h1 id=sql-ddl>SQL (DDL)</h1><h2 id=table-1>Table</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 基本操作
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sample_table3</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>id</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>c1</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>unique</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>c2</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>c3</span><span class=w> </span><span class=nb>text</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;abc&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>c4</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=n>now</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=n>old_table_name</span><span class=err>}</span><span class=w> </span><span class=k>rename</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=err>{</span><span class=n>new_table_name</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>owner</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=err>{</span><span class=n>new_role</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>rename</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=err>{</span><span class=n>old_column_name</span><span class=err>}</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=err>{</span><span class=n>new_column_name</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=err>{</span><span class=n>DEFINE</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=err>{</span><span class=n>DEFINE</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 主キー
</span></span></span><span class=line><span class=cl><span class=c1>-- 制約名: {table_name}_pkey
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=err>{</span><span class=n>pri_keyname</span><span class=err>}</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=n>_pkey</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ユニーク
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>unique</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=k>unique</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=n>_c1_key</span><span class=w> </span><span class=k>unique</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=n>_c1_key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- not null
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>alter</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>c1</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>alter</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>c1</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- foreign key
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>references</span><span class=w> </span><span class=err>{</span><span class=n>ref_table_name</span><span class=err>}</span><span class=p>(</span><span class=err>{</span><span class=n>ref_column_name</span><span class=err>}</span><span class=p>)</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=k>delete</span><span class=w> </span><span class=k>cascade</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=k>update</span><span class=w> </span><span class=k>cascade</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>foreign</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=p>)</span><span class=w> </span><span class=k>references</span><span class=w> </span><span class=err>{</span><span class=n>ref_table_name</span><span class=err>}</span><span class=p>(</span><span class=err>{</span><span class=n>ref_column_name</span><span class=err>}</span><span class=p>)</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=k>delete</span><span class=w> </span><span class=k>cascade</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=k>update</span><span class=w> </span><span class=k>cascade</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=n>_fkey</span><span class=w> </span><span class=k>foreign</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=k>column_name</span><span class=p>)</span><span class=w> </span><span class=k>references</span><span class=w> </span><span class=err>{</span><span class=n>ref_table_name</span><span class=err>}</span><span class=p>(</span><span class=err>{</span><span class=n>ref_column_name</span><span class=err>}</span><span class=p>)</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=k>delete</span><span class=w> </span><span class=k>cascade</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=k>update</span><span class=w> </span><span class=k>cascade</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- check
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=err>{</span><span class=k>table_name</span><span class=err>}</span><span class=n>_</span><span class=err>{</span><span class=k>column_name</span><span class=err>}</span><span class=n>_check</span><span class=w> </span><span class=k>check</span><span class=p>(</span><span class=err>{</span><span class=n>expr</span><span class=err>}</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- parition
</span></span></span><span class=line><span class=cl><span class=c1>-- from 以上 to 未満
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>tbl</span><span class=w> </span><span class=p>(</span><span class=n>c1</span><span class=w> </span><span class=nb>serial</span><span class=p>,</span><span class=w> </span><span class=n>c2</span><span class=w> </span><span class=nb>text</span><span class=p>,</span><span class=w> </span><span class=n>c3</span><span class=w> </span><span class=nb>date</span><span class=p>)</span><span class=w> </span><span class=n>partition</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>range</span><span class=p>(</span><span class=n>c3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>tbl_y2011m10</span><span class=w> </span><span class=n>partition</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>tbl</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2011-10-01&#39;</span><span class=p>)</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2019-10-01&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>tbl_y2019m10</span><span class=w> </span><span class=n>partition</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>tbl</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2019-10-01&#39;</span><span class=p>)</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2020-10-01&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>tbl_y2020m10</span><span class=w> </span><span class=n>partition</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>tbl</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2020-10-01&#39;</span><span class=p>)</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2022-10-01&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>tbl</span><span class=p>(</span><span class=n>c2</span><span class=p>,</span><span class=w> </span><span class=n>c3</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2011-10-01&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>tbl</span><span class=p>(</span><span class=n>c2</span><span class=p>,</span><span class=w> </span><span class=n>c3</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2019-10-01&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>tbl</span><span class=p>(</span><span class=n>c2</span><span class=p>,</span><span class=w> </span><span class=n>c3</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2019-10-02&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>tbl</span><span class=w> </span><span class=n>attach</span><span class=w> </span><span class=n>partition</span><span class=w> </span><span class=err>{</span><span class=n>partition_name</span><span class=err>}</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=err>{</span><span class=n>condition</span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>tbl</span><span class=w> </span><span class=n>detach</span><span class=w> </span><span class=n>partition</span><span class=w> </span><span class=err>{</span><span class=n>partition_name</span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=sequence>Sequence</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=n>sequence</span><span class=w> </span><span class=n>sample_seq</span><span class=w> </span><span class=k>start</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=k>increment</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>nextval</span><span class=p>(</span><span class=s1>&#39;sample_seq&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>currval</span><span class=p>(</span><span class=s1>&#39;sample_seq&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>setval</span><span class=p>(</span><span class=s1>&#39;sample_seq&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h2 id=view>View</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>view</span><span class=w> </span><span class=n>sample_view</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>val</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>c2</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>sample_table1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=index>Index</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>index</span><span class=w> </span><span class=n>idx_name</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>sample_table1</span><span class=w> </span><span class=p>[</span><span class=k>using</span><span class=w> </span><span class=n>index_type</span><span class=p>](</span><span class=k>column_name</span><span class=p>)</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>expr</span><span class=w>
</span></span></span></code></pre></div><table><thead><tr><th>Type</th><th>Desc</th></tr></thead><tbody><tr><td>B-Tree</td><td>一般的</td></tr><tr><td>GiST</td><td>主に空間情報の検索に使用。2次元以上の空間に対する一致や包括の検索に用いる</td></tr><tr><td>GIN</td><td>主に全文検索に用いられる転置インデックス。ある要素がどの列に有るかを検索するのに用いる</td></tr><tr><td>Hash</td><td>値の一致検索のみをする際に用いる</td></tr></tbody></table><h2 id=function--procedure>Function / Procedure</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>function</span><span class=w> </span><span class=n>sample_func</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span><span class=w> </span><span class=k>returns</span><span class=w> </span><span class=n>sample_table1</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=err>$$</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>sample_table1</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=err>$</span><span class=mi>1</span><span class=w> </span><span class=err>$$</span><span class=w> </span><span class=k>LANGUAGE</span><span class=w> </span><span class=k>SQL</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>procedure</span><span class=w> </span><span class=n>sample_prc</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=err>$$</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>sample_table1</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=err>$</span><span class=mi>1</span><span class=w> </span><span class=err>$$</span><span class=w> </span><span class=k>LANGUAGE</span><span class=w> </span><span class=k>SQL</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=aggregate-number>Aggregate (number)</h2><table><thead><tr><th>Name</th><th>Desc</th></tr></thead><tbody><tr><td>abs(x)</td><td>絶対値</td></tr><tr><td>div(x, y)</td><td>x / y の整数商</td></tr><tr><td>mod(x, y)</td><td>x / y の余剰</td></tr><tr><td>sqrt(x)</td><td>x の平方根</td></tr><tr><td>power(x, y)</td><td>x^y</td></tr><tr><td>ceil(x)</td><td>少数切り上げ</td></tr><tr><td>floor(x)</td><td>少数切り捨て (負の値に注意)</td></tr><tr><td>round(x), round(x, y)</td><td>少数四捨五入. y で桁指定</td></tr><tr><td>trunc(x), trunc(x, y)</td><td>少数切り捨て. y で桁指定</td></tr><tr><td>log(x)</td><td>常用対数 log_10(x)</td></tr><tr><td>pi()</td><td>円周率</td></tr><tr><td>random()</td><td><code>0 &lt;= x &lt;1</code></td></tr></tbody></table><table><thead><tr><th>Name</th><th>Desc</th></tr></thead><tbody><tr><td>|/x</td><td>平方根</td></tr><tr><td>||/x</td><td>立方根</td></tr><tr><td>x!</td><td>階乗</td></tr><tr><td>!!x</td><td>階乗</td></tr><tr><td>@</td><td>絶対値</td></tr></tbody></table><h2 id=aggregate-text>Aggregate (text)</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=err>列名</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;条件 (%: 0文字以上のワイルドカード. _: 1文字のワイルドカード)&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>列名</span><span class=w> </span><span class=k>similar</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=s1>&#39;条件 (like に加えて正規表現が使用可能)&#39;</span><span class=w>
</span></span></span></code></pre></div><table><thead><tr><th>Name</th><th>Desc</th></tr></thead><tbody><tr><td>length, char_length</td><td>文字列長</td></tr><tr><td>octed_length</td><td>バイト数</td></tr><tr><td>substring(&lsquo;ABC&rsquo; from 2 for 3)</td><td>切り出し. 1始まり</td></tr><tr><td>upper</td><td>大文字</td></tr><tr><td>lower</td><td>小文字</td></tr><tr><td>repeat(&lsquo;abc&rsquo;, 2)</td><td>繰り返し</td></tr><tr><td>replace(&lsquo;abc&rsquo;, &lsquo;ab&rsquo;, &lsquo;xx&rsquo;)</td><td>文字列置換</td></tr><tr><td>lpad(&lsquo;abc&rsquo;, 2, &lsquo;z&rsquo;)</td><td>左埋め</td></tr><tr><td>rpad(&lsquo;abc&rsquo;, 2, &lsquo;z&rsquo;)</td><td>右埋め</td></tr><tr><td>trim((leading|both|trailing) &lsquo;z&rsquo; from &lsquo;zabcz&rsquo;)</td><td>前後から指定文字を削除</td></tr><tr><td>ltrim(&lsquo;zabcz&rsquo;, &lsquo;z&rsquo;)</td><td>左から指定文字を削除</td></tr><tr><td>rtrim(&lsquo;zabcz&rsquo;, &lsquo;z&rsquo;)</td><td>右から指定文字を削除</td></tr></tbody></table><table><thead><tr><th>Name</th><th>Desc</th></tr></thead><tbody><tr><td>||</td><td>文字列結合</td></tr><tr><td>~, <del>*, !</del></td><td>正規表現、正規表現(大文字区別せず)、不一致</td></tr></tbody></table><h2 id=aggregate-date>Aggregate (date)</h2><table><thead><tr><th>Name</th><th>Desc</th><th>Range</th></tr></thead><tbody><tr><td>now()</td><td>タイムスタンプ</td><td>トランザクション</td></tr><tr><td>localtimestamp</td><td>タイムスタンプ</td><td>トランザクション</td></tr><tr><td>localtime</td><td>時刻</td><td>トランザクション</td></tr><tr><td>current_timestamp</td><td>タイムスタンプ</td><td>トランザクション</td></tr><tr><td>current_time</td><td>時刻</td><td>トランザクション</td></tr><tr><td>current_date</td><td>日付</td><td>トランザクション</td></tr><tr><td>statement_timestamp</td><td>タイムスタンプ</td><td>ステートメント</td></tr><tr><td>clock_timestamp</td><td>タイムスタンプ</td><td>関数呼び出し時</td></tr><tr><td>age(f, t)</td><td>差分</td><td>-</td></tr><tr><td>extract(day from current_timestamp)</td><td>抽出</td><td>-</td></tr><tr><td>date_part(&lsquo;day&rsquo;, current_timestamp)</td><td>抽出</td><td>-</td></tr><tr><td>date_trunc(&lsquo;day&rsquo;, current_timestamp)</td><td>切り捨て</td><td>-</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=nb>date</span><span class=w> </span><span class=s1>&#39;2019-01-01&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>integer</span><span class=w> </span><span class=s1>&#39;7&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nb>date</span><span class=w> </span><span class=s1>&#39;2019-01-01&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>interval</span><span class=w> </span><span class=s1>&#39;7 hour&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>to_date</span><span class=p>(</span><span class=s1>&#39;2019-01-01&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;YYYY-MM-DD&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>to_timestamp</span><span class=p>(</span><span class=s1>&#39;2019-01-01 12:34:56&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>to_number</span><span class=p>(</span><span class=s1>&#39;123.45&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;999.99&#39;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div></section></article></main></div><div><footer id=site-footer class=toplevel-container><p>このサイトでは <a href=https://icons8.jp/>icons8</a> の素材を使用しています。</p><p>&copy; 2024 namoshika, All rights reserved</p></footer></div></div></body></html>